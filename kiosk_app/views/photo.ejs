<!doctype html>
<html lang='en' class='h-100' data-bs-theme='auto'>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <% let title = lang.photos.title_view %>
    <title><%= title %></title>
    <link href='bootstrap.min.css' rel='stylesheet'>
    <script src='/socket.io/socket.io.js'></script>
    <style>
      .container-cam {
        max-width: 800px;
      }
      .btn-mod {
        --bs-btn-padding-y: 1rem;
      }
    </style>
  </head>
  <body class='d-flex flex-column h-100'>

    <main class='flex-shrink-0'>
      <%- include('home_button', { url: './', text: lang.home_button }) %>

      <div id='review' class='container container-cam'>
        <div class='camera'>
            <img id='photo' class='img-fluid' src='placeholder_image.jpg'/>
        </div>

        <div class='row m-5 align-items-center'>
          <div class='col-3 gap-2 ml-auto'>
            <label class='form-label' for='project'><%= lang.photos.select_project %>:</label>
          </div>
          <div class='col-8 gap-2 mr-auto'>
            <select class='form-select' id='users' name='project'>
              <option value='photo_booth'><%= lang.home.camera %></option>
              <% if (typeof projects != 'undefined') { -%>
                <% projects.forEach((project) => { -%>
                  <option value='<%= project.$loki %>'><%= project.name %></option>
              <% });} -%>
            </select>
          </div>
        </div>

        <div class='d-grid gap-2 row-gap-100 col-8 mx-auto'>
          <div class='my-5'>
            <form id='email-form'>
            <input type='email' class='form-control' id='email' placeholder='<%= lang.photos.email_address %>'>
            <button
            id='send-photo'
            class='btn btn-primary btn-lg mt-3'
            ><%= lang.photos.send_email %></button>
            </form>
            <p
            id='email-sent-msg'
            style='display: none;'
            ><%= lang.photos.email_sent %></p>
          </div>
          <button
          id='to-camera'
          class='btn btn-primary btn-lg mx-5 btn-mod'
          ><%= lang.photos.to_camera %></button>
        </div>
      </div>

    </main>
  </body>
  <script type='text/javascript'>

    let email_form = document.getElementById('email-form');
    let email_sent_msg = document.getElementById('email-sent-msg');
    let send_photo = document.getElementById('send-photo');

    window.onload = (event) => {
      send_photo.addEventListener(
        'click',
        (ev) => {
          socket.emit('send_email', document.getElementById('email').value, photo.src);
          email_form.style.display = 'none';
          email_sent_msg.style.display = 'block';
          ev.preventDefault();
        },
        false
      );
    }

  </script>
</html>
