<!doctype html>
<html lang='en' class='h-100' data-bs-theme='auto'>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <% let title = lang.photos.title_view %>
    <title><%= title %></title>
    <link href='bootstrap.min.css' rel='stylesheet'>
    <script src='/socket.io/socket.io.js'></script>
    <style>
      .container-cam {
        max-width: 800px;
      }
      .btn-mod {
        --bs-btn-padding-y: 1rem;
      }
    </style>
  </head>
  <body class='d-flex flex-column h-100'>

    <main class='flex-shrink-0'>
      <%- include('home_button', { url: './', text: lang.home_button }) %>

      <div id='review' class='container container-cam'>

        <% if (typeof msg != 'undefined') { -%>
          <div class='alert alert-warning' role='alert'>
            <%= msg %>
          </div>
        <% } -%>

        <div class='photo'>
            <% let url = typeof file != 'undefined' ? './media/' + media_dir + '/' + file : 'placeholder_image.jpg' %>
            <img id='photo' class='img-fluid' src='<%= url %>' />
        </div>

        <form method='post' action='photo/move' id='select-project-form'>
          <div class='row m-5 align-items-center'>
            <div class='col-3 gap-2 mx-auto'>
              <label class='form-label' for='project_id'><%= lang.photos.select_project %>:</label>
            </div>
            <div class='col-5 gap-2 mx-auto'>
              <select class='form-select' id='project_list' name='project_id'>
                <option value='no_project'><%= lang.photos.no_project %></option>
                <% if (typeof projects != 'undefined') { -%>
                  <% projects.forEach((project) => { -%>
                    <option value='<%= project.$loki %>'><%= project.name %></option>
                <% });} -%>
              </select>
            </div>
            <div class='col-2 gap-2 mx-auto'>
              <input type='hidden' id='previous_project_id' name='previous_project_id' value='<%= project_id %>' />
              <input type='hidden' id='file' name='file' value='<%= file %>' />
              <input type='submit' id='select-project' class='btn btn-primary btn-lg' value='<%= lang.photos.select_project_btn %>'/>
            </div>
          </div>
        </form>

        <form method='post' action='photo/email' id='email-form'>
          <div class='row m-5 align-items-center'>
            <div class='col-9 gap-2 mx-auto'>
              <input type='email' class='form-control' id='email' placeholder='<%= lang.photos.email_address %>'>
            </div>
            <div class='col-2 gap-2 mx-auto'>
              <button id='send-photo' class='btn btn-primary btn-lg'><%= lang.photos.send_email %></button>
            </div>
          </div>
        </form>
        <div class='row my-3 align-items-center'>
          <p id='email-sent-msg' style='text-align: center; display: none;'><%= lang.photos.email_sent %></p>
        </div>

        <div class='d-grid gap-2 row-gap-100 col-4 mx-auto my-3'>
          <button id='to-camera' class='btn btn-primary btn-lg btn-mod' ><%= lang.photos.to_camera %></button>
        </div>
      </div>

    </main>
  </body>
  <script type='text/javascript'>

    let socket = io();

    let email_form = document.getElementById('email-form');
    let email_sent_msg = document.getElementById('email-sent-msg');
    let send_photo = document.getElementById('send-photo');
    // let select_project = document.getElementById('select-project');

    window.onload = (event) => {

      send_photo.addEventListener(
        'click',
        (ev) => {
          socket.emit('send_email', document.getElementById('email').value, photo.src);
          email_form.style.display = 'none';
          email_sent_msg.style.display = 'block';
          ev.preventDefault();
        },
        false
      );

      // select_project.addEventListener(
      //   'click',
      //   (ev) => {
      //     socket.emit('select_project', document.getElementById('project_list').value);
      //     ev.preventDefault();
      //   },
      //   false
      // );

    }

  </script>
</html>
